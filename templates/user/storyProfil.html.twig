{% extends 'base.html.twig' %}

{% block title %}
    Mes histoires
{% endblock %}

{% block body %}
    {# pour la gestion d'erreur #}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{label}}">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}

    <div id="profil">
        {% if user.avatar %}
            <picture>
                <img src="{{ asset('uploads/user/' ~ user.avatar) }}" alt="image avatar" id="bigAvatar" class="width100">
            </picture>
            <picture>
                <img src="/uploads/user/{{user.avatar}}" alt="image avatar" id="littleAvatar"> 
            </picture>
        {% else %}
            <picture>
                <img src="{{ asset('img/avatar_base.png') }}" alt="image faux avatar" id="bigAvatar" class="width100">
            </picture>
            <picture>
                <img src="/img/avatar_base.png" alt="image faux avatar" id="littleAvatar"> 
            </picture>
        {% endif %}
        <nav class="flex justifyContent">
            <a href="{{path('app_profil')}}" class="textBlack">Mes informations</a>
            <a href="">|</a>
            <a href="{{path('app_subscriptionProfil')}}" class="textBlack">Mes abonnements</a>
            <a href="">|</a>
            <a href="{{path('app_libraryProfil')}}" class="textBlack">Ma blibliothèque</a>
            <a href="">|</a>
            <a href="{{path('app_storyProfil')}}" class="textBlack"><b>Mes histoires</b></a>
        </nav>
        {# si le role autheur n'est pas dans les roles alors j'affiche  #}
        {% if app.user and 'ROLE_AUTHOR' not in app.user.roles %}
            <a href="{{path('form_become_author', {'user' : app.user.id})}}" class="textBlack bouton backgroundPink">Devenir écrivain</a>
        {% elseif app.user and 'ROLE_AUTHOR' in app.user.roles %}
        
            <a href="{{path('create_story', {'user': app.user.id})}}" class="textBlack bouton backgroundPink">Créer une histoire</a>
            <main class="flex">
                {# si l'autheur a des histoires alors je les affiches #}
                {% if stories | length > 0 %}
                    <section class="stories flex flexDirectionRow">
                        {% for story in stories %}
                            <div class="story textCenter">
                                <img src="{{ asset('uploads/story/' ~ story.cover) }}" alt="image de couverture">
                                <h3>{{story.name}}  </h3>
                                <a class="bouton backgroundPurple textBlack" href="{{path('detail_story', {'id' : story.id})}}">Voir plus <i class="fa-solid fa-arrow-right"></i></a>
                            </div>
                        {% endfor %}
                    </section>
                {% endif %}
            </main>
        {% endif %}
    </div>

{% endblock %}